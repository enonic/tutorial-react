:sourcedir: ../
:imagesdir: media/

= Rich text

The RichText component is able to render HTML text and comes with basic components for images, links and macros that can be customized.

Depending on how your web application is `hosted`, urls generated by the `default components` may not work for your implementation,
which is why you can create your own `Image` and `Link` components and pass those to the RichText component.

In addition, the RichText component doesn't really know how macros are supposed to look, so its default `Macro` component will simply render a placeholder.

== Links

`Link` component is used by `RichText` to correctly resolve and render links inside an HTML content.

The default implementation generates links based on the `href` from a GraphQL query.

You can see that by going to the http://localhost:3000/p/lea-seydoux/a8b374a2-c532-45eb-9aa1-73d1c37cd681[Lea Seydoux^] page and clicking the http://localhost:8080/site/intro/master/persons/daniel-craig[Daniel Craig^] link inside Lea's biography:

image::./craig-default-render.png[width=1132]

This is a default content preview generated by Enonic XP and not by our React app.
To make our app handle it we need to change the link URL to be like `/p/:name/:personId` as we defined in the <<person#, Person chapter>>.

You can easily do it with custom `Link` component:

.src/components/Link.tsx
[source,TypeScript]
----
include::{sourcedir}src/main/resources/static/components/Link.tsx[]
----

What we did is:

- For content type ending with `person` we constructed `/p/:name/:personId` URL.
- For media content, we used the `href` attribute because media is hosted by Enonic XP, and we want to keep the links as they are.
- For all other links we just render text because our app can not handle it.

Now we just need to add it to the `RichText` component:

.src/components/Person.tsx
[source,TypeScript]
----
import {Link} from './Link';

// ...

<RichText<RestProps>
  // ...
  Link={Link}
  // ...
/>
----

If you go to the http://localhost:3000/p/lea-seydoux/a8b374a2-c532-45eb-9aa1-73d1c37cd681[Lea Seydoux^] page and click on the http://localhost:3000/p/daniel-craig/f29ba9b7-a73a-4767-82db-9da4df952924[Daniel Craig^] link now, you should see the page rendered by our app:

image::./craig-app-render.png[width=1242]

== Images

If you want to have more control over image rendering, you can provide `RichText` with your own custom `Image` component:

.src/components/Image.tsx
[source,TypeScript]
----
include::{sourcedir}src/main/resources/static/components/Image.tsx[]
----

It doesn't do anything special, but this is a good place to add your own logic to images.

You can add it to the `RichText` component like this:

.src/components/Person.tsx
[source,TypeScript]
----
import {Image} from './Image';

// ...

<RichText
  ...
  Image={Image}
  ...
/>
----

== Macros

Unlike `Link` and `Image`, `RichText` doesn't know how to render `Macro` and prints warning when encountering them.

TIP: Read more about XP https://developer.enonic.com/docs/xp/stable/cms/macros[Macros^].

=== General component

You will see a warning in the middle of the biography on the http://localhost:3000/p/lea-seydoux/a8b374a2-c532-45eb-9aa1-73d1c37cd681[Lea Seydoux^] page:

image::./lea-no-macro.png[width=1200]

That is because to render macros, you need to create your own implementation that knows how to render a specific macro!

Let's create a `Macro.tsx` file:

.src/components/Macro.tsx
[source,TypeScript]
----
include::{sourcedir}src/main/resources/static/components/Macro.tsx[]
----

The Macro component above uses `FactBox` component to render all macros that have `com.enonic.app.intro:factbox` descriptor.

It will throw an error otherwise, which will cause the `RichText` component's `ErrorBoundary` to render an `Error placeholder`.

Remember to import and add `Macro` component to the `RichText` component:

.src/components/Person.tsx
[source,TypeScript]
----
import {Macro} from './Macro';

// ..

<RichText<RestProps>
  // ...
  Macro={Macro}
  // ...
/>
----

=== Factbox component

But we are not done yet.
We need to create an actual implementation of the `FactBox` macro that is used by our `Macro` component.

Create a `FactBox.tsx` component:

.src/components/macros/FactBox.tsx
[source,TypeScript]
----
include::{sourcedir}src/main/resources/static/components/macros/FactBox.tsx[]
----

NOTE: Remember that `guillotineUrl` and `personId` are available in macros because we added them to `RichText` component previously.

=== Styling

To style the macro we are using https://www.reacttutorial.com/css-modules-react[css modules^] again.

Create a `FactBox.module.css` file with the following content:

.src/components/macros/FactBox.module.css
[source,css]
----
include::{sourcedir}src/main/resources/static/components/macros/FactBox.module.css[]
----

=== GraphQL query

`FactBox` macro imports `PERSON_MOVIES_QUERY` GraphQL query that we need to create now:

.src/queries/personMovies.ts
[source,GraphQL]
----
include::{sourcedir}src/main/resources/static/queries/personMovies.ts[]
----

Congratulations!
If you did everything correctly, you should see the `FactBox` macro rendered inside the biography on the http://localhost:3000/p/lea-seydoux/a8b374a2-c532-45eb-9aa1-73d1c37cd681[Lea Seydoux^] page:

image::./lea-with-macro.png[width=1200]

== Custom params

You can pass additional params to the `RichText` component by supplying a generic interface declaring them, in this case it is called `RestProps`:

[source,TypeScript]
----
<RichText<RestProps>
  ...
  guillotineUrl={guillotineUrl}
  personId={personId}
  ...
/>
----

And it declares additional params `guillotineUrl` and `personId`:

.src/components/index.d.ts
[source,TypeScript]
----
include::{sourcedir}src/main/resources/static/components/index.d.ts[]
----

These params will be passed to the `Image`, `Link` and `Macro` components as well.

== Next step

Now you are ready to create you own React webapp with https://developer.enonic.com/docs/intro/stable/api[headless Enonic XP^] using https://www.npmjs.com/package/@enonic/react-components[@enonic/react-components^] library.
