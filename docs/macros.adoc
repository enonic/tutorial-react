:sourcedir: ../
:imagesdir: media/

= Macros - custom rich text components

RichText also supports custom components - aka `Macros`.

== Background

In order to support more complex componentry within Enonic's rich text editor, you can define macros.

TIP: Details on defining macros can be found in the https://developer.enonic.com/docs/xp/stable/cms/macros[XP documentation^].


== Default macro handling

The sample content contains an example macro called `Factbox`, which has been added to the http://localhost:3000/p/lea-seydoux/a8b374a2-c532-45eb-9aa1-73d1c37cd681[Lea Seydoux^] bio.

By default, the RichText component will simply render a fallback placeholder:

image::no-macro.png[width=663]

To improve the situation, start by implementing a Factbox component.

== Factbox component

Add the following files to your project:

.src/components/FactBox.tsx
[source,TypeScript]
----
include::{sourcedir}src/components/FactBox.tsx[]
----

NOTE: The optional body of a macro is available as a React component called `children`.

.src/components/FactBox.module.css
[source,css]
----
include::{sourcedir}src/components/FactBox.module.css[]
----

Like other components, you may also declare a query for your Macro - but in this case we already have everything we need in the data returned from the original `bio` query.

== The Macro component

We now have a Factbox component, but we still need to map it to the Enonic macro definition. The solution is a Macro component.

.src/components/Macro.tsx
[source,TypeScript]
----
include::{sourcedir}src/components/Macro.tsx[]
----

This component takes care of mapping each macro to its corresponding React component. In our case, `FactBox` component implements the macro called `com.enonic.app.intro:factbox` in Enonic.

It will throw an error otherwise, which will cause the RichText component's `ErrorBoundary` to render an `Error placeholder`.

== Add to RichText

Finally, import and pass it to the `RichText` component:

.src/components/Person.tsx
[source,TypeScript]
----
import {Macro} from './Macro';

// ..

<RichText
  // ...
  Macro={Macro}
  // ...
/>
----

If you did everything correctly, you should now see the `FactBox` macro rendered inside the biography on the http://localhost:3000/p/lea-seydoux/a8b374a2-c532-45eb-9aa1-73d1c37cd681[Lea Seydoux^] page:

image::./factbox-macro.png[width=1028]


== A final tip

You may pass additional parameters, such as `personID` to the RichText component by supplying a generic interface declaring them:

[source,TypeScript]
----
<RichText<RestProps>
  ...
  personID="paramValue"
  ...
/>

interface RestProps {
  personID: string;
}
----

These params will be passed on to the `Image`, `Link` and `Macro` components as well.

== Next steps

Congratulations on completing this tutorial.

For more details on our React components, visit https://www.npmjs.com/package/@enonic/react-components[the NPM documentation^].

To learn more about Enonic's CMS capabilities, we recommend the https://developer.enonic.com/docs/developer-101[Developer 101 tutorial].

To dive deeper into React and building sites with Enonic, have a look at our https://developer.enonic.com/docs/next.xp[Next.js] integration.
